# 地址
https://juejin.im/post/5e65fbd6e51d45271849ee33

# 总结
一.进程和线程
1.进程
(1).在操作系统中，程序以进程的方式使用系统资源，包括程序和数据所用的空间、系统外设、文件等程序运行时所需的系统资源，并且以分时共享的方式使用处理机资源。在进程运行过程中，操作系统不断的将系统资源以独占的方式或者与其他进程共享的方式分配给进程。
2.线程
(1).线程是进程的更小的单位，在一个进程中可以包含多个并发的执行的线程。系统将按进程分配所有除CPU以外的系统资源（如主存、外设、文件等），而程序则依赖于线程运行，系统按照线程分配CPU资源，引入线程之后，进程概念内涵变了，进程只做除CPU以外的系统资源的分配单位。

3.进程和线程的关系
(1).一个进程中至少要包含一个线程，线程的引入可以使进程细化为可以并发执行的部分
二.同步和异步
1.同步
(1).同步就是按照顺序先做完一件事情才能做下一件事情。
2.异步
(1).简单理解就是:两件事情同时进行。
三.浏览器的进程
1.浏览器主要包含哪些进程
(1).Browser 进程：浏览器的主进程，只有一个，负责创建和销毁其它进程、网络资源的下载与管理、浏览器界面的展示、前进后退等。
(2).GPU 进程：用于 3D 绘制等，最多一个。
(3).第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建。
(4).浏览器渲染进程（浏览器内核）：内部是多线程的，每打开一个新网页就会创建一个进程，主要用于页面渲染，脚本执行，事件处理等。
2.浏览器的进程个数怎么计算
(1).不管打开一个或多个新的空白窗口，都只计算为打开了一个Browser进程
(2).在新的空白窗口中加载一个网页，计算为一个浏览器渲染进程
(3).其他进程如果有用到，则相应计数加一
四.浏览器渲染进程
1.浏览器渲染过程
(1).构建DOM
(2).构建CSSOM
(3).构建Render Tree
(4).Layout
(5).Painting

构建 DOM、构建 CSSOM、构建 Render Tree”这三点任何一点的改变都有可能会重复执行“Layout、Painting”，具体可以总结为两个方面：

回流（Reflow）
涉及到页面布局的几何属性的改变会引发回流

重绘（Repaint）
不影响页面布局的，只涉及到外观变化的改变会引发重绘
2.浏览器渲染进程包含哪些线程
(1).GUI 渲染引擎线程：负责渲染浏览器界面，解析HTML，CSS，构建DOM、CSSOM、Render Tree，布局（Layout）和绘制（Painting） 等。当界面需要重绘（Repaint）或由于某种操作引发回流（Reflow）时，该线程也会执行。
(2).JavaScript 引擎线程：也称为 JavaScript 内核，负责处理、解析 、运行 Javascript 代码（例如 V8 引擎）。
(3).事件触发线程：用来控制浏览器事件循环，注意这是浏览器的操作，不属于 JavaScript 引擎线程管，当事件被触发时，该线程会把事件添加到待处理队列的队尾，等待 JavaScript 引擎的处理。
(4).定时触发器线程： setInterval 与 setTimeout 所在线程，执行将返回定时触发器在系统中的ID，可以通过这个ID来取消定时触发器。W3C 在 HTML 标准中规定，规定要求 setTimeout 中低于 4ms 的时间间隔算为 4ms 。
(5).异步 http 请求线程：在 XMLHttpRequest 连接后通过浏览器新开一个请求线程，接下来检测状态变更，如果相应的状态下设置有回调函数，异步线程就会产生状态变更事件，将这个回调再放入事件处理队列中，等待 JavaScript 引擎的处理。
3.GUI 渲染线程与 JavaScript 引擎线程是互斥的
当 JavaScript 引擎线程执行时 GUI 线程会被挂起（相当于被冻结了），GUI 更新会被保存在一个队列中等到 JavaScript 引擎空闲时立即被执行。所以如果 JavaScript 执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞。
五JavaScript 是单线程的
1.单线程的理解
(1).单线程指的是这门语言是单线程的，可以理解为程序在执行中过程中代码执行的顺序是依次执行的，必须是上一句的代码执行完才开始执行下一句代码。
2.为什么 JavaScript 是单线程的呢
(1).JavaScript 是可以操作DOM节点的，假设 JavaScript 是多线程的，多线程也就意味着可以并发执行，假定JavaScript 同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？所以为了避免这些情况的出现，JavaScript 是单线程的

六 任务队列
(1).S分为同步任务和异步任务
(2).同步任务都在主线程上执行，形成一个执行栈
(3).主线程之外，事件触发线程管理着一个任务队列，只要异步任务（如定时器，http请求）出现，就会在任务队列中放置一个事件
(4).一旦执行栈中的所有同步任务执行完毕（此时JS引擎空闲），系统就会读取任务队列，将可运行的异步任务添加到可执行栈中，开始执行

七 宏任务 macrotask
主要包含：

script(整体代码)、setTimeout、setInterval、I/O、UI交互事件、postMessage、MessageChannel、setImmediate(Node.js 环境)

八 微任务（microtask）
Promise.then、MutaionObserver、process.nextTick(Node.js 环境)

九 事件循环 eventloop
1.什么是事件循环
(1).主线程不断从消息队列中获取消息，执行消息，这个过程成为事件循环，这种机制叫做循环机制，去一次消息并执行的过程叫一次循环。
2.事件循环运行的机制
(1).执行一个宏任务，如果执行栈中没有就从任务队列中获取
(2).执行过程中如果产生微任务，就加他添加到微任务队列中
(3).宏任务执行完毕之后，立即依次执行微任务队列中的所有微任务
(4).当前宏任务执行完毕之后，开始检查渲染，然后GUI线程接管渲染
(5).渲染完毕之后，JS线程继续接管，开始下一个宏任务（从事件队列中获取）

十 Promise、async/await、setTimeout在事件循环中的执行
1.Promise/then、catch中的任务怎么执行
(1).Promise中的异步体现在then和catch中，then和catch中的代码一定要等Promise中的代码执行完才能执行，而不是并发执行
2.async/await中的任务怎么执行
(1).async/await与Promise的作用相同，async/await 本身就是promise+generator的语法糖。
(2).async中的代码是被当做同步任务来执行的，在主线程的执行栈中，一旦轮到它执行了就会立即执行。
(3).await实际上是一个让出线程的标志，await后面的表达式会先执行一遍，将await后面的代码加入到微任务队列中，然后就会跳出整个async函数来执行后面的代码。
3.setTimeout中的任务怎么执行
JS引擎线程在在解析JS代码时，遇到setTimeout，浏览器渲染进程会新开一个线程定时器触发线程，此时，setTimeout中的回调函数将加入任务队列里面，等主线程执行栈中上一个宏任务执行完毕，在下一轮事件循环时回调函数才从任务队列中被添加到执行栈中执行
